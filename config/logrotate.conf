# Solr Log Rotation Configuration v2.5.0
# Manages rotation of Solr application logs and GC logs

# Main Solr logs (solr.log, solr_gc.log, etc.)
/var/solr/logs/*.log {
    # Rotate daily
    daily

    # Keep logs for 14 days
    rotate 14

    # Compress rotated logs (except most recent)
    compress
    delaycompress

    # Don't error if log is missing
    missingok

    # Don't rotate empty logs
    notifempty

    # Copy and truncate instead of moving (Solr keeps file handle open)
    copytruncate

    # Maximum size before rotation (regardless of time)
    maxsize 100M

    # Don't mail logs
    nomail

    # Create new log files with correct permissions
    create 0644 8983 8983

    # Date extension format
    dateext
    dateformat -%Y%m%d-%s

    # Post-rotation script
    postrotate
        echo "$(date '+%Y-%m-%d %H:%M:%S') - Solr logs rotated" >> /var/solr/logs/rotation.log || true
    endscript
}

# GC logs (if enabled)
/var/solr/logs/gc*.log {
    daily
    rotate 7
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
    maxsize 50M
    create 0644 8983 8983
    dateext
}

# Rotation log itself (prevent infinite growth)
/var/solr/logs/rotation.log {
    weekly
    rotate 4
    compress
    missingok
    notifempty
    copytruncate
    maxsize 10M
}
